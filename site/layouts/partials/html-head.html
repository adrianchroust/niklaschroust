<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="author" content="{{ .Site.Params.Author }}">
<meta name="theme-color" content="#121111">

{{ $background := index .Site.Data.background_images (cond (eq .Kind "404") "404" "default") }}
{{ with index .Site.Data.background_images.sections .Section }}{{ $background = . }}{{ end }}
<link rel="preload" as="image" href="{{ $background }}">
<style>
	html, body {background-color: #121111;}
	.page {display: none;}
	.page::before {--url: url({{ $background | safeCSS }});}
</style>

{{ $style := resources.Get "css/main.scss" | toCSS | postCSS }}
{{ if hugo.IsProduction }}{{ $style = $style | minify }}{{ end }}
{{ $style = $style | fingerprint }}
<link rel="stylesheet" href="{{ $style.RelPermalink }}" media="print" onload="this.onload=null;this.media='all'">

{{ $font := "https://fonts.googleapis.com/css2?family=Crimson+Text&display=swap" }}
<link rel="stylesheet" href="{{ $font }}" media="print" onload="this.onload=null;this.media='all'">

<noscript>
	<style>.page::before {--url: url({{ $background | safeCSS }});}</style>
	<link rel="stylesheet" href="{{ $style.RelPermalink }}">
	<link rel="stylesheet" href="{{ $font }}">
</noscript>

<script src="https://instant.page/5.1.0" type="module" integrity="sha384-by67kQnR+pyfy8yWP4kPO12fHKRLHZPfEsiSXR8u2IKcTdxD805MGUXBzVPnkLHw"></script>

{{ $sw := resources.Get "js/sw.js" | resources.ExecuteAsTemplate "sw.js" . | fingerprint }}
{{ $app := resources.Get "js/app.js" | resources.ExecuteAsTemplate "js/app.js" $sw.RelPermalink | fingerprint }}
{{ if hugo.IsProduction }}
	{{ $sw = $sw | minify }}
	{{ $app = $app | minify }}
{{ end }}
<script src="{{ $app.RelPermalink }}" type="module"></script>

{{ if hugo.IsProduction }}
	{{ template "_internal/google_analytics_async.html" . }}
{{ end }}
